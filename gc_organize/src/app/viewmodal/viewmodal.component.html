<div class="modal-overlay modal-blur flex items-center justify-center fixed inset-0 bg-black/60 backdrop-blur-sm p-4 animate-fade-in" style="z-index: 3000;" (click)="closeModal()">
  <div
    class="modal-content relative w-full max-w-sm md:max-w-4xl h-[85vh] md:h-[600px] rounded-2xl overflow-hidden shadow-2xl flex flex-col md:flex-row bg-white mx-auto animate-scale-in border-2 border-gray-200"
    role="dialog" aria-modal="true" aria-labelledby="viewmodal-title" (click)="$event.stopPropagation()">

    <!-- Colored top border based on department -->
    <div
      class="absolute top-0 left-0 right-0 h-1.5 z-20"
      [ngClass]="{
        'bg-orange-500': event?.department === 'CCS',
        'bg-yellow-400': event?.department === 'CBA',
        'bg-red-500': event?.department === 'CAHS',
        'bg-blue-500': event?.department === 'CEAS',
        'bg-pink-400': event?.department === 'CHTM',
        'bg-[#679436]': !event?.department || event?.department === 'OSWS'
      }"
      aria-hidden="true"></div>

    <!-- Close button -->
    <button (click)="closeModal()" aria-label="Close dialog"
      class="absolute top-4 right-4 w-10 h-10 flex items-center justify-center rounded-full bg-gray-100 hover:bg-gray-200 text-gray-600 hover:text-gray-900 cursor-pointer z-30 focus:outline-none focus:ring-2 focus:ring-[#679436] transition-all duration-200 shadow-md">
      <i class="fas fa-times text-lg"></i>
    </button>

    <!-- Poster / Visual side -->
    <div
      class="w-full md:w-2/5 h-[280px] md:h-full flex-shrink-0 overflow-hidden flex items-center justify-center relative bg-gray-50">
      <div class="absolute inset-0" id="blurredBackground"
        style="background-size: cover; background-position: center; filter: blur(12px); opacity: 0.3;"></div>
      <img [src]="getPosterUrl()"
        class="w-auto h-auto max-w-[85%] max-h-[85%] object-contain relative z-[1] drop-shadow-2xl rounded-lg"
        alt="Event poster">
    </div>

    <!-- Content side -->
    <div class="w-full md:w-3/5 flex flex-col overflow-hidden">
      <!-- Header Section -->
      <div class="p-6 pb-4 border-b-2 border-gray-100">
        <div class="flex items-start justify-between gap-4 mb-3">
          <h2 id="viewmodal-title" class="font-bold text-2xl md:text-3xl leading-tight text-[#679436] flex-1">
            {{ event.title }}
          </h2>
        </div>
        
        <!-- Department and Status Badges -->
        <div class="flex items-center gap-2 flex-wrap">
          <span class="inline-flex items-center px-3 py-1.5 rounded-full text-xs font-bold text-white border-2"
                [ngClass]="{
                  'bg-orange-500 border-orange-600': event?.department === 'CCS',
                  'bg-yellow-400 border-yellow-500': event?.department === 'CBA',
                  'bg-red-500 border-red-600': event?.department === 'CAHS',
                  'bg-blue-500 border-blue-600': event?.department === 'CEAS',
                  'bg-pink-400 border-pink-500': event?.department === 'CHTM',
                  'bg-[#679436] border-[#56732e]': !event?.department || event?.department === 'OSWS'
                }">
            {{ event?.department ? event.department : 'OSWS' }}
          </span>
          
          <span *ngIf="event.status"
                class="inline-flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-bold border-2"
                [ngClass]="{
                  'bg-yellow-50 text-yellow-800 border-yellow-300': getDisplayStatus() === 'not yet started',
                  'bg-blue-50 text-blue-800 border-blue-300': getDisplayStatus() === 'ongoing',
                  'bg-green-50 text-green-800 border-green-300': getDisplayStatus() === 'concluded',
                  'bg-red-50 text-red-800 border-red-300': getDisplayStatus() === 'cancelled'
                }">
            <span class="w-2 h-2 rounded-full"
                  [ngClass]="{
                    'bg-yellow-500': getDisplayStatus() === 'not yet started',
                    'bg-blue-600': getDisplayStatus() === 'ongoing',
                    'bg-green-600': getDisplayStatus() === 'concluded',
                    'bg-red-600': getDisplayStatus() === 'cancelled'
                  }"></span>
            <span>{{ (event?.status || '') | titlecase }}</span>
          </span>

          <!-- Event Type Badge -->
          <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-bold border-2"
                [ngClass]="event?.is_paid ? 'bg-amber-50 text-amber-800 border-amber-300' : 'bg-emerald-50 text-emerald-800 border-emerald-300'">
            <i class="fas text-xs" [ngClass]="event?.is_paid ? 'fa-peso-sign' : 'fa-ticket-alt'"></i>
            {{ event?.is_paid ? 'Paid Event' : 'Free Event' }}
          </span>
          
          <span *ngIf="event?.is_paid && (event.registration_fee ?? 0) > 0"
                class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-bold border-2 bg-amber-50 text-amber-900 border-amber-300">
            <i class="fas fa-peso-sign text-xs"></i>
            {{ event.registration_fee | number:'1.2-2' }}
          </span>
        </div>
      </div>

      <!-- Scrollable Content Section -->
      <div class="flex-1 overflow-y-auto p-6 space-y-5">
        <!-- Description -->
        <div>
          <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wide mb-2">Description</h3>
          <p class="text-gray-700 text-base leading-relaxed whitespace-pre-line">
            {{ event.description }}
          </p>
        </div>

        <!-- Event Details Grid -->
        <div>
          <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wide mb-3">Event Details</h3>
          <div class="space-y-3">
            <!-- Location -->
            <div class="flex items-start gap-3 p-3 bg-gray-50 rounded-lg border-2 border-gray-200">
              <div class="w-10 h-10 flex items-center justify-center bg-white rounded-lg border-2 border-gray-300 flex-shrink-0">
                <i class="fas fa-map-marker-alt text-gray-600"></i>
              </div>
              <div class="flex-1 min-w-0">
                <p class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Location</p>
                <p class="text-sm font-medium text-gray-900 mt-0.5">{{ event.location }}</p>
              </div>
            </div>

            <!-- Date -->
            <div class="flex items-start gap-3 p-3 bg-gray-50 rounded-lg border-2 border-gray-200">
              <div class="w-10 h-10 flex items-center justify-center bg-white rounded-lg border-2 border-gray-300 flex-shrink-0">
                <i class="fas fa-calendar-alt text-gray-600"></i>
              </div>
              <div class="flex-1 min-w-0">
                <p class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Date</p>
                <p class="text-sm font-medium text-gray-900 mt-0.5">
                  {{ event.start_date | date: 'MMMM d, y' }}
                  <ng-container *ngIf="event.end_date && event.end_date !== event.start_date">
                    - {{ event.end_date | date: 'MMMM d, y' }}
                  </ng-container>
                </p>
              </div>
            </div>

            <!-- Time -->
            <div class="flex items-start gap-3 p-3 bg-gray-50 rounded-lg border-2 border-gray-200">
              <div class="w-10 h-10 flex items-center justify-center bg-white rounded-lg border-2 border-gray-300 flex-shrink-0">
                <i class="fas fa-clock text-gray-600"></i>
              </div>
              <div class="flex-1 min-w-0">
                <p class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Time</p>
                <p class="text-sm font-medium text-gray-900 mt-0.5">
                  {{ formatTime(event.start_time) }}
                  <ng-container *ngIf="event.end_time && event.end_time !== event.start_time">
                    - {{ formatTime(event.end_time) }}
                  </ng-container>
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
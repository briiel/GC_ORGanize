
<div class="p-2 sm:p-3 md:p-4 lg:p-6 bg-gray-100 min-h-screen overflow-x-hidden">
  <!-- Header -->
  <div class="mb-3 sm:mb-4 md:mb-5 lg:mb-6 mx-0 sm:mx-2 lg:mx-6">
    <div class="shadow-md rounded-lg overflow-hidden border-l-4"
         [ngClass]="isOsws ? 'bg-white border-[#14532d]' : 'bg-white border-[#679436]'">
      <div class="px-3 sm:px-4 md:px-5 py-2.5 sm:py-3 md:py-4 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-3">
        <div class="flex items-center gap-2 sm:gap-3 min-w-0 flex-1">
          <div class="w-8 h-8 sm:w-9 sm:h-9 md:w-10 md:h-10 rounded-lg flex items-center justify-center flex-shrink-0"
               [ngClass]="isOsws ? 'bg-[#14532d]' : 'bg-[#679436]'">
            <i class="fas fa-clipboard-list text-white text-xs sm:text-sm md:text-base"></i>
          </div>
          <div class="min-w-0 flex-1">
            <h1 class="text-sm sm:text-base md:text-lg lg:text-xl font-semibold text-gray-800 truncate">Attendance Records</h1>
            <p class="text-gray-600 text-[10px] sm:text-xs md:text-sm mt-0.5 truncate">View and manage event attendance</p>
          </div>
        </div>
        <!-- Status legend -->
        <div class="w-full sm:w-auto rounded-lg border-2 border-gray-200 bg-gray-50 px-2 sm:px-3 md:px-4 py-1.5 sm:py-2 text-[9px] sm:text-[10px] md:text-xs flex-shrink-0">
          <div class="flex flex-wrap items-center gap-x-2 sm:gap-x-3 md:gap-x-4 gap-y-1 text-gray-700">
            <span class="inline-flex items-center gap-0.5 sm:gap-1">
              <span class="relative inline-flex rounded-full h-2 w-2 sm:h-2.5 sm:w-2.5 md:h-3 md:w-3 bg-yellow-400 border border-yellow-500 flex-shrink-0"></span>
              <span class="font-medium whitespace-nowrap">Not Yet Started</span>
            </span>
            <span class="inline-flex items-center gap-0.5 sm:gap-1">
              <span class="relative flex h-2 w-2 sm:h-2.5 sm:w-2.5 md:h-3 md:w-3 flex-shrink-0">
                <span class="absolute inline-flex h-full w-full rounded-full opacity-60 animate-ping bg-blue-400"></span>
                <span class="relative inline-flex rounded-full h-2 w-2 sm:h-2.5 sm:w-2.5 md:h-3 md:w-3 bg-blue-500 border border-blue-600"></span>
              </span>
              <span class="font-medium whitespace-nowrap">Ongoing</span>
            </span>
            <span class="inline-flex items-center gap-0.5 sm:gap-1">
              <span class="relative inline-flex rounded-full h-2 w-2 sm:h-2.5 sm:w-2.5 md:h-3 md:w-3 bg-green-500 border border-green-600 flex-shrink-0"></span>
              <span class="font-medium whitespace-nowrap">Concluded</span>
            </span>
            <span class="inline-flex items-center gap-0.5 sm:gap-1">
              <span class="relative inline-flex rounded-full h-2 w-2 sm:h-2.5 sm:w-2.5 md:h-3 md:w-3 bg-red-500 border border-red-600 flex-shrink-0"></span>
              <span class="font-medium whitespace-nowrap">Cancelled</span>
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div *ngIf="error" class="text-red-600 mx-2 sm:mx-4 lg:mx-6 text-xs sm:text-sm">{{ error }}</div>
  <div class="mx-2 sm:mx-4 lg:mx-6 flex flex-col md:flex-row gap-3 sm:gap-4 md:gap-6 max-w-full overflow-x-hidden">
    <!-- Vertical event list -->
    <div class="w-full md:w-1/3 lg:w-1/4 md:max-w-xs lg:max-w-sm min-w-0">
      <div class="bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden flex flex-col max-h-[600px]">
        <div class="px-3 sm:px-4 md:px-5 py-2.5 sm:py-3 flex-shrink-0"
             [ngClass]="isOsws ? 'bg-[#14532d]' : 'bg-[#679436]'">
          <div class="flex items-center gap-2 sm:gap-3">
            <div class="w-7 h-7 sm:w-8 sm:h-8 rounded-lg bg-white/90 flex items-center justify-center flex-shrink-0">
              <i class="fas fa-calendar-alt text-xs sm:text-sm"
                 [ngClass]="isOsws ? 'text-[#14532d]' : 'text-[#679436]'"></i>
            </div>
            <h2 class="text-base sm:text-lg font-semibold text-white truncate">Events</h2>
          </div>
        </div>
        <div class="px-2 sm:px-3 md:px-4 py-2 sm:py-2.5 md:py-3 bg-white flex gap-1.5 sm:gap-2 items-center border-b border-gray-200">
          <input
            type="text"
            [(ngModel)]="eventSearchTerm"
            (ngModelChange)="onEventSearch()"
            placeholder="Search events..."
            class="flex-1 px-2 sm:px-3 py-2 sm:py-2.5 rounded-lg border border-gray-300 text-black text-xs sm:text-sm focus:outline-none focus:ring-2 focus:border-transparent min-h-[44px]"
            [ngClass]="isOsws ? 'focus:ring-[#14532d]' : 'focus:ring-[#679436]'"
            style="min-width:0;"
          />
        </div>
  <ul class="divide-y divide-gray-200 flex-1 overflow-y-auto" style="max-height: 450px;">
            <li *ngFor="let event of pagedEvents; let i = index" class="hover:bg-gray-50 transition-colors duration-200 flex">
            <span class="px-2 sm:px-3 py-2.5 sm:py-3 text-gray-400 font-bold text-xs sm:text-sm flex items-center flex-shrink-0"
              [ngClass]="selectedEvent && selectedEvent.event_id === event.event_id ? 'bg-gray-50' : ''"
            >{{ (eventPage - 1) * eventsPerPage + i + 1 }}.</span>
            <button
              class="flex-1 text-left px-2 sm:px-2.5 py-2.5 sm:py-3 font-semibold hover:underline focus:outline-none min-h-[44px]"
              [ngClass]="[
                isOsws ? 'text-[#14532d]' : 'text-[#679436]',
                selectedEvent && selectedEvent.event_id === event.event_id ? 'bg-gray-50' : '',
                'focus:bg-gray-50'
              ]"
              (click)="selectEvent(event)"
              [title]="event.title"
            >
              <div class="flex items-center justify-between gap-2 w-full">
                <span class="truncate text-xs sm:text-sm flex-1 min-w-0" [title]="event.title">{{ event.title }}</span>
                <div class="flex items-center gap-1.5 flex-shrink-0">
                  <span class="inline-flex items-center gap-0.5 px-1.5 py-0.5 rounded-full border text-[9px] font-semibold"
                        [ngClass]="event.is_paid ? 'bg-amber-50 text-amber-800 border-amber-200' : 'bg-emerald-50 text-emerald-800 border-emerald-200'">
                    <i class="fas text-[8px]" [ngClass]="event.is_paid ? 'fa-coins' : 'fa-ticket-alt'"></i>
                  </span>
                  <span *ngIf="event.status"
                        class="inline-flex items-center flex-shrink-0"
                        [title]="(event.status || '') | titlecase"
                        [attr.aria-label]="'Status: ' + ((event.status || '') | titlecase)">
                    <span class="relative flex h-2.5 w-2.5 sm:h-3 sm:w-3">
                      <span *ngIf="(event.status || '').toLowerCase() === 'ongoing'"
                            class="absolute inline-flex h-full w-full rounded-full opacity-60 animate-ping bg-blue-400"></span>
                      <span class="relative inline-flex rounded-full h-2.5 w-2.5 sm:h-3 sm:w-3 border"
                        [ngClass]="{
                          'bg-yellow-400 border-yellow-500': (event.status || '').toLowerCase() === 'not yet started',
                          'bg-blue-500 border-blue-600': (event.status || '').toLowerCase() === 'ongoing',
                          'bg-green-500 border-green-600': (event.status || '').toLowerCase() === 'concluded',
                          'bg-red-500 border-red-600': (event.status || '').toLowerCase() === 'cancelled'
                        }"></span>
                    </span>
                  </span>
                </div>
              </div>
            </button>
          </li>
          <li *ngIf="filteredEvents.length > eventsPerPage" class="px-2 sm:px-3 py-2 bg-white border-t border-gray-200 flex justify-center items-center">
            <nav class="inline-flex gap-1 sm:gap-1.5" aria-label="Pagination">
              <button
                class="w-10 h-10 sm:w-11 sm:h-11 flex items-center justify-center rounded bg-gray-200 hover:bg-gray-300 disabled:opacity-50 transition-colors min-h-[44px] min-w-[44px]"
                [disabled]="eventPage === 1"
                (click)="setEventPage(eventPage - 1)">
                <i class="fas fa-chevron-left text-xs sm:text-sm"></i>
              </button>
              <ng-container *ngFor="let _ of [].constructor(totalEventPages); let i = index">
                <button
                  class="w-10 h-10 sm:w-11 sm:h-11 flex items-center justify-center rounded transition-colors duration-150 min-h-[44px] min-w-[44px] text-xs sm:text-sm font-medium"
                  [ngClass]="eventPage === (i + 1) ? 'bg-[#679436] text-white font-bold' : 'bg-gray-200 hover:bg-gray-300 text-gray-800'"
                  [attr.aria-current]="eventPage === (i + 1) ? 'page' : null"
                  (click)="setEventPage(i + 1)">
                  {{ i + 1 }}
                </button>
              </ng-container>
              <button
                class="w-10 h-10 sm:w-11 sm:h-11 flex items-center justify-center rounded bg-gray-200 hover:bg-gray-300 disabled:opacity-50 transition-colors min-h-[44px] min-w-[44px]"
                [disabled]="eventPage === totalEventPages"
                (click)="setEventPage(eventPage + 1)">
                <i class="fas fa-chevron-right text-xs sm:text-sm"></i>
              </button>
            </nav>
          </li>
          <li *ngIf="filteredEvents.length === 0" class="text-center py-4 sm:py-5 md:py-6 text-gray-500 bg-gray-50 font-semibold text-xs sm:text-sm">No events found.</li>
        </ul>
      </div>
    </div>
    <!-- Attendees table for selected event -->
    <div class="w-full md:flex-1 hidden md:block min-w-0">
      <div class="bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden">
        <ng-container *ngIf="selectedEvent; else selectEventMsg">
          <!-- Header -->
          <div class="px-3 sm:px-4 md:px-5 py-2.5 sm:py-3 md:py-4"
               [ngClass]="isOsws ? 'bg-[#14532d]' : 'bg-[#679436]'">
            <div class="flex items-center justify-between gap-2 sm:gap-3">
              <div class="flex items-center gap-2 sm:gap-3 flex-1 min-w-0">
                <div class="w-7 h-7 sm:w-8 sm:h-8 md:w-9 md:h-9 rounded-lg bg-white/90 flex items-center justify-center flex-shrink-0">
                  <i class="fas fa-users text-xs sm:text-sm md:text-base"
                     [ngClass]="isOsws ? 'text-[#14532d]' : 'text-[#679436]'"></i>
                </div>
                <div class="flex-1 min-w-0">
                  <h2 class="text-sm sm:text-base md:text-lg font-semibold text-white truncate">{{ selectedEvent.title }}</h2>
                  <p class="text-white/90 text-[10px] sm:text-xs mt-0.5">Attendance records</p>
                </div>
                <span class="inline-flex items-center gap-0.5 sm:gap-1 px-2 sm:px-3 py-1 sm:py-1.5 rounded-full border-2 text-[10px] sm:text-xs font-semibold flex-shrink-0"
                      [ngClass]="selectedEvent.is_paid ? 'bg-amber-100 text-amber-800 border-amber-300' : 'bg-emerald-100 text-emerald-800 border-emerald-300'">
                  <i class="fas text-[8px] sm:text-[10px]" [ngClass]="selectedEvent.is_paid ? 'fa-coins' : 'fa-ticket-alt'"></i>
                  <span class="hidden sm:inline">{{ selectedEvent.is_paid ? 'Paid' : 'Free' }}</span>
                </span>
              </div>
              <button
                (click)="selectedEvent = null; filteredRecords = []; searchTerm = ''"
                class="w-10 h-10 sm:w-11 sm:h-11 flex items-center justify-center rounded-full bg-white/20 hover:bg-white/30 text-white transition-colors duration-200 hover:rotate-90 flex-shrink-0 min-h-[44px] min-w-[44px]"
                title="Close"
                aria-label="Close attendance view">
                <i class="fas fa-times text-sm sm:text-base"></i>
              </button>
            </div>
          </div>
          
          <!-- Search and Actions -->
          <div class="p-2 sm:p-3 md:p-4 lg:p-6">
            <div class="flex flex-row gap-2 items-center mb-2 sm:mb-3 md:mb-4">
              <div class="flex flex-row flex-wrap md:flex-nowrap gap-2 w-full">
                <input
                  type="text"
                  placeholder="Search by student name, ID, department, or program..."
                  class="flex-1 px-3 sm:px-4 py-2 sm:py-2.5 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:border-transparent shadow-sm min-w-0 text-xs sm:text-sm md:text-base min-h-[44px]"
                  [ngClass]="isOsws ? 'focus:ring-[#14532d]' : 'focus:ring-[#679436]'"
                  [(ngModel)]="searchTerm"
                  (ngModelChange)="onSearch()"
                  (keyup.enter)="onSearch()"
                />
                <button
                  class="text-white font-semibold px-3 sm:px-4 md:px-6 py-2 sm:py-2.5 rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl flex items-center justify-center gap-1.5 sm:gap-2 min-h-[44px] w-auto text-xs sm:text-sm md:text-base flex-shrink-0"
                  [ngClass]="isOsws ? 'bg-[#14532d] hover:bg-[#166534]' : 'bg-[#679436] hover:bg-[#56732e]'"
                  (click)="onSearch()"
                  type="button"
                >
                  <i class="fas fa-search text-xs sm:text-sm"></i>
                  <span>Search</span>
                </button>
                <button
                  *ngIf="searchTerm"
                  class="bg-white hover:bg-gray-50 text-gray-700 font-semibold px-3 sm:px-4 py-2 sm:py-2.5 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg border-2 border-gray-300 flex items-center justify-center gap-1.5 sm:gap-2 min-h-[44px] w-auto text-xs sm:text-sm md:text-base flex-shrink-0"
                  (click)="clearSearch()"
                  type="button"
                >
                  <i class="fas fa-times text-xs sm:text-sm"></i>
                  <span>Clear</span>
                </button>
                <button
                  (click)="downloadExcel()"
                  class="bg-blue-600 hover:from-blue-700 hover:to-blue-800 text-white font-semibold px-3 sm:px-4 md:px-6 py-2 sm:py-2.5 rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl flex items-center justify-center gap-1.5 sm:gap-2 min-h-[44px] w-auto min-w-[44px] text-xs sm:text-sm md:text-base whitespace-nowrap flex-shrink-0"
                  [disabled]="filteredRecords.length === 0"
                  type="button"
                >
                  <i class="fas fa-file-excel text-sm sm:text-base"></i>
                  <span class="hidden sm:inline">Download Excel</span>
                </button>
              </div>
            </div>
            <!-- Table -->
            <div class="overflow-x-auto shadow-sm">
              <ng-container *ngIf="filteredRecords.length > 0; else noAttendeesMsg">
                <table *ngIf="!error" class="min-w-full divide-y divide-gray-200">
                  <thead
                         [ngClass]="isOsws ? 'bg-[#14532d]' : 'bg-[#679436]'">
                      <tr class="uppercase tracking-wider text-white text-[10px] sm:text-xs lg:text-sm">
                        <th class="px-2 sm:px-3 py-2 sm:py-2.5 md:py-3 text-center w-8 sm:w-10 md:w-12 font-semibold">#</th>
                        <th class="px-2 sm:px-3 py-2 sm:py-2.5 md:py-3 text-center min-w-[100px] font-semibold">Student ID</th>
                        <th class="px-2 sm:px-3 py-2 sm:py-2.5 md:py-3 text-center min-w-[180px] font-semibold">Name</th>
                        <th class="px-2 sm:px-3 py-2 sm:py-2.5 md:py-3 text-center min-w-[100px] font-semibold">Dept</th>
                        <th class="px-2 sm:px-3 py-2 sm:py-2.5 md:py-3 text-center min-w-[150px] font-semibold">Program</th>
                        <th class="px-2 sm:px-3 py-2 sm:py-2.5 md:py-3 text-center min-w-[140px] font-semibold">Time In</th>
                        <th class="px-2 sm:px-3 py-2 sm:py-2.5 md:py-3 text-center min-w-[140px] font-semibold">Time Out</th>
                        <th class="px-2 sm:px-3 py-2 sm:py-2.5 md:py-3 text-center min-w-[160px] font-semibold">Scanned By</th>
                        <th class="px-2 sm:px-3 py-2 sm:py-2.5 md:py-3 text-center min-w-[120px] font-semibold">Position</th>
                      </tr>
                    </thead>
                    <tbody class="bg-white text-gray-800 divide-y divide-gray-200">
                      <tr *ngFor="let record of pagedRecords; let i = index" 
                          class="hover:bg-gray-50 transition-all duration-200 even:bg-gray-50/50">
                        <td class="px-2 sm:px-3 py-2 sm:py-2.5 md:py-3 text-center font-semibold text-xs sm:text-sm"
                            [ngClass]="isOsws ? 'text-[#14532d]' : 'text-[#679436]'">{{ (recordPage - 1) * recordsPerPage + i + 1 }}</td>
                        <td class="px-2 sm:px-3 py-2 sm:py-2.5 md:py-3 text-center text-[10px] sm:text-xs">{{ record.student_id || '-' }}</td>
                        <td class="px-2 sm:px-3 py-2 sm:py-2.5 md:py-3 text-center text-xs sm:text-sm" [title]="formatName(record)">
                          <div class="line-clamp-2">{{ formatName(record) }}</div>
                        </td>
                        <td class="px-2 sm:px-3 py-2 sm:py-2.5 md:py-3 text-center text-xs" [title]="record.department">{{ record.department || '-' }}</td>
                        <td class="px-2 sm:px-3 py-2 sm:py-2.5 md:py-3 text-center text-xs sm:text-sm" [title]="record.program">
                          <div class="line-clamp-2">{{ record.program || '-' }}</div>
                        </td>
                        <td class="px-2 sm:px-3 py-2 sm:py-2.5 md:py-3 text-center text-[10px] sm:text-xs">{{ formatDateTime(record.time_in || record.attended_at) }}</td>
                        <td class="px-2 sm:px-3 py-2 sm:py-2.5 md:py-3 text-center text-[10px] sm:text-xs">{{ formatDateTime(record.time_out) }}</td>
                        <td class="px-2 sm:px-3 py-2 sm:py-2.5 md:py-3 text-center text-xs sm:text-sm" [title]="record.scanned_by">
                          <div class="line-clamp-2">{{ record.scanned_by || '-' }}</div>
                        </td>
                        <td class="px-2 sm:px-3 py-2 sm:py-2.5 md:py-3 text-center text-[10px] sm:text-xs" [title]="record.scanned_by_position">
                          <div class="line-clamp-2">{{ record.scanned_by_position || '-' }}</div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </ng-container>
                <ng-template #noAttendeesMsg>
                  <div class="text-center py-8 sm:py-10 text-gray-500 font-semibold bg-gray-50 text-xs sm:text-sm">No attendees found for this event.</div>
                </ng-template>
              </div>
              
              <!-- Pagination for records table -->
              <div *ngIf="filteredRecords.length > recordsPerPage" class="flex justify-center items-center py-2.5 sm:py-3 md:py-4 border-t border-gray-200">
                <nav class="inline-flex gap-1 sm:gap-1.5" aria-label="Pagination">
                  <button
                    class="w-10 h-10 sm:w-11 sm:h-11 flex items-center justify-center rounded bg-gray-200 hover:bg-gray-300 disabled:opacity-50 transition-colors duration-150 min-h-[44px] min-w-[44px]"
                    [disabled]="recordPage === 1"
                    (click)="setRecordPage(recordPage - 1)">
                    <i class="fas fa-chevron-left text-xs sm:text-sm"></i>
                  </button>
                  <ng-container *ngFor="let _ of [].constructor(totalRecordPages); let i = index">
                    <button
                      class="w-10 h-10 sm:w-11 sm:h-11 flex items-center justify-center rounded transition-colors duration-150 min-h-[44px] min-w-[44px] text-xs sm:text-sm font-medium"
                      [ngClass]="recordPage === (i + 1) ? 
                        (isOsws ? 'bg-[#14532d] text-white font-bold' : 'bg-[#679436] text-white font-bold') : 
                        'bg-gray-200 hover:bg-gray-300 text-gray-800'"
                      [attr.aria-current]="recordPage === (i + 1) ? 'page' : null"
                      (click)="setRecordPage(i + 1)">
                      {{ i + 1 }}
                    </button>
                  </ng-container>
                  <button
                    class="w-10 h-10 sm:w-11 sm:h-11 flex items-center justify-center rounded bg-gray-200 hover:bg-gray-300 disabled:opacity-50 transition-colors duration-150 min-h-[44px] min-w-[44px]"
                    [disabled]="recordPage === totalRecordPages"
                    (click)="setRecordPage(recordPage + 1)">
                    <i class="fas fa-chevron-right text-xs sm:text-sm"></i>
                  </button>
                </nav>
              </div>
          </div>
        </ng-container>
        <ng-template #selectEventMsg>
          <div class="p-12 sm:p-16 md:p-20 text-center">
            <i class="fas fa-hand-pointer text-4xl sm:text-5xl md:text-6xl text-gray-300 mb-3 sm:mb-4"></i>
            <p class="text-gray-500 text-base sm:text-lg font-semibold">Select an event to view attendees</p>
            <p class="text-gray-400 text-xs sm:text-sm mt-1.5 sm:mt-2">Choose an event from the list on the left</p>
          </div>
        </ng-template>
      </div>
    </div>
  </div>



<!-- Mobile: modal for records table -->
<div *ngIf="selectedEvent && showMobileModal" class="fixed inset-0 flex items-center justify-center bg-black/60 backdrop-blur-sm animate-fade-in md:hidden p-3" style="z-index: 3000;">
  <div class="mobile-attendance-modal bg-white rounded-xl shadow-2xl w-full max-w-[min(500px,calc(100vw-24px))] relative mx-auto animate-scale-in flex flex-col"
    style="max-height: 90vh;">
    
    <!-- Modal Header -->
    <div class="px-3 sm:px-4 md:px-6 py-3 sm:py-3.5 md:py-4 flex items-center justify-between rounded-t-xl"
         [ngClass]="isOsws ? 'bg-gradient-to-r from-[#14532d] to-[#166534]' : 'bg-gradient-to-r from-[#679436] to-[#56732e]'">
      <div class="flex items-center gap-2.5 flex-1 min-w-0 pr-2">
        <div class="w-10 h-10 rounded-lg bg-white/20 flex items-center justify-center flex-shrink-0">
          <i class="fas fa-users text-white text-sm"></i>
        </div>
        <div class="flex-1 min-w-0">
          <h2 class="text-base font-bold text-white truncate leading-tight">{{ selectedEvent.title }}</h2>
          <p class="text-xs text-white/90 mt-0.5">Attendance Records</p>
        </div>
      </div>
      <button (click)="showMobileModal = false" class="w-10 h-10 rounded-full bg-white/20 hover:bg-white/30 text-white flex items-center justify-center transition-all duration-200 hover:rotate-90 min-h-[44px] min-w-[44px] flex-shrink-0" aria-label="Close">
        <i class="fas fa-times text-base"></i>
      </button>
    </div>
    
    <!-- Modal Content -->
    <div class="flex-1 overflow-y-auto px-4 py-3" style="-webkit-overflow-scrolling: touch; overscroll-behavior: contain;">
      <div class="space-y-3">
      <!-- Search and Actions -->
      <div class="space-y-2">
        <input
          type="text"
          placeholder="Search by student name or ID..."
          class="w-full px-3.5 py-2.5 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:border-transparent shadow-sm text-sm min-h-[44px]"
          [ngClass]="isOsws ? 'focus:ring-[#14532d]' : 'focus:ring-[#679436]'"
          [(ngModel)]="searchTerm"
          (ngModelChange)="onSearch()"
          (keyup.enter)="onSearch()"
        />
        <div class="flex gap-2">
          <button
            class="text-white font-semibold px-4 py-2.5 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg flex items-center justify-center gap-2 min-h-[44px] flex-1 text-sm"
            [ngClass]="isOsws ? 'bg-[#14532d] hover:bg-[#166534]' : 'bg-[#679436] hover:bg-[#56732e]'"
            (click)="onSearch()"
            type="button"
          >
            <i class="fas fa-search text-xs"></i>
            <span>Search</span>
          </button>
          <button
            *ngIf="searchTerm"
            class="bg-white hover:bg-gray-50 text-gray-700 font-semibold px-4 py-2.5 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg border-2 border-gray-300 flex items-center justify-center gap-2 min-h-[44px] flex-1 text-sm"
            (click)="clearSearch()"
            type="button"
          >
            <i class="fas fa-times text-xs"></i>
            <span>Clear</span>
          </button>
          <button
            (click)="downloadExcel()"
            class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2.5 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg flex items-center justify-center gap-2 min-h-[44px] min-w-[44px] text-sm"
            [disabled]="filteredRecords.length === 0"
            type="button"
            [title]="'Download Excel'"
          >
            <i class="fas fa-file-excel text-sm"></i>
          </button>
        </div>
      </div>
      <!-- Responsive Table for Mobile -->
      <div class="overflow-x-auto rounded-lg border border-gray-200 shadow-sm">
        <ng-container *ngIf="filteredRecords.length > 0; else noAttendeesMobileMsg">
          <table class="min-w-full divide-y divide-gray-200 bg-white">
            <thead [ngClass]="isOsws ? 'bg-[#14532d]' : 'bg-[#679436]'">
              <tr class="text-white text-[10px] uppercase tracking-wide">
                <th class="px-2 py-2 text-center font-semibold sticky left-0 z-10" [ngClass]="isOsws ? 'bg-[#14532d]' : 'bg-[#679436]'">#</th>
                <th class="px-2 py-2 text-center font-semibold whitespace-nowrap">Student ID</th>
                <th class="px-2 py-2 text-left font-semibold whitespace-nowrap">Name</th>
                <th class="px-2 py-2 text-center font-semibold">Dept</th>
                <th class="px-2 py-2 text-left font-semibold whitespace-nowrap">Program</th>
                <th class="px-2 py-2 text-center font-semibold whitespace-nowrap">Time In</th>
                <th class="px-2 py-2 text-center font-semibold whitespace-nowrap">Time Out</th>
                <th class="px-2 py-2 text-left font-semibold whitespace-nowrap">Scanned By</th>
                <th class="px-2 py-2 text-center font-semibold">Position</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-200 bg-white">
              <tr *ngFor="let record of pagedRecords; let i = index" class="hover:bg-gray-50 transition-colors even:bg-gray-50/50">
                <td class="px-2 py-2 text-center font-bold text-[11px] sticky left-0 z-10 bg-inherit"
                    [ngClass]="isOsws ? 'text-[#14532d]' : 'text-[#679436]'">
                  {{ (recordPage - 1) * recordsPerPage + i + 1 }}
                </td>
                <td class="px-2 py-2 text-center text-[10px] whitespace-nowrap">{{ record.student_id || '-' }}</td>
                <td class="px-2 py-2 text-center text-[11px]">
                  <div class="max-w-[120px] truncate" [title]="formatName(record)">{{ formatName(record) }}</div>
                </td>
                <td class="px-2 py-2 text-center text-[10px]">{{ record.department || '-' }}</td>
                <td class="px-2 py-2 text-center text-[10px]">
                  <div class="max-w-[100px] truncate" [title]="record.program">{{ record.program || '-' }}</div>
                </td>
                <td class="px-2 py-2 text-center text-[9px] whitespace-nowrap">{{ formatDateTime(record.time_in || record.attended_at) }}</td>
                <td class="px-2 py-2 text-center text-[9px] whitespace-nowrap">{{ formatDateTime(record.time_out) }}</td>
                <td class="px-2 py-2 text-center text-[10px]">
                  <div class="max-w-[100px] truncate" [title]="record.scanned_by">{{ record.scanned_by || '-' }}</div>
                </td>
                <td class="px-2 py-2 text-center text-[10px]">
                  <div class="max-w-[80px] truncate" [title]="record.scanned_by_position">{{ record.scanned_by_position || '-' }}</div>
                </td>
              </tr>
            </tbody>
          </table>
        </ng-container>
        <ng-template #noAttendeesMobileMsg>
          <div class="text-center py-8 text-gray-500 font-semibold bg-gray-50 text-sm">No attendees found for this event.</div>
        </ng-template>
      </div>
      
      <!-- Pagination -->
      <div *ngIf="filteredRecords.length > recordsPerPage" class="flex justify-center items-center mt-3 pt-3 border-t border-gray-200">
        <nav class="inline-flex gap-1.5" aria-label="Pagination">
          <button
            class="w-10 h-10 flex items-center justify-center rounded-lg bg-gray-200 hover:bg-gray-300 disabled:opacity-50 transition-colors duration-150 min-h-[44px] min-w-[44px]"
            [disabled]="recordPage === 1"
            (click)="setRecordPage(recordPage - 1)">
            <i class="fas fa-chevron-left text-xs"></i>
          </button>
          <ng-container *ngFor="let _ of [].constructor(totalRecordPages); let i = index">
            <button
              class="w-10 h-10 flex items-center justify-center rounded-lg transition-colors duration-150 min-h-[44px] min-w-[44px] text-sm font-medium"
              [ngClass]="recordPage === (i + 1) ? 
                (isOsws ? 'bg-[#14532d] text-white font-bold' : 'bg-[#679436] text-white font-bold') : 
                'bg-gray-200 hover:bg-gray-300 text-gray-800'"
              [attr.aria-current]="recordPage === (i + 1) ? 'page' : null"
              (click)="setRecordPage(i + 1)">
              {{ i + 1 }}
            </button>
          </ng-container>
          <button
            class="w-10 h-10 flex items-center justify-center rounded-lg bg-gray-200 hover:bg-gray-300 disabled:opacity-50 transition-colors duration-150 min-h-[44px] min-w-[44px]"
            [disabled]="recordPage === totalRecordPages"
            (click)="setRecordPage(recordPage + 1)">
            <i class="fas fa-chevron-right text-xs"></i>
          </button>
        </nav>
      </div>
    </div>
  </div>
</div>


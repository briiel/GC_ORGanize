<div class="fixed inset-0 modal-blur flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in" style="z-index: 3000;" (click)="closeModal()">
  <div class="scrollable-container bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden animate-scale-in relative"
    role="dialog" aria-modal="true" aria-labelledby="registermodal-title" (click)="$event.stopPropagation()">
    
    <!-- Colored top border gradient -->
    <div class="h-2 bg-[#679436] rounded-t-2xl"></div>

    <form class="modal-flex-form flex flex-col h-full" (ngSubmit)="submitRegistration()">
      <!-- Header -->
      <div class="px-6 pt-6 pb-4 border-b-2 border-gray-100">
        <div class="flex items-start justify-between gap-4">
          <div class="flex-1">
            <h2 id="registermodal-title" class="text-2xl md:text-3xl font-bold text-[#679436] mb-2">
              Event Registration
            </h2>
            <p class="text-sm text-gray-600">Please review your information and complete the registration form</p>
          </div>
          <button type="button" (click)="closeModal()" aria-label="Close dialog"
            class="w-10 h-10 flex items-center justify-center rounded-full bg-gray-100 hover:bg-gray-200 text-gray-600 hover:text-gray-900 cursor-pointer transition-all duration-200 shadow-md focus:outline-none focus:ring-2 focus:ring-[#679436] flex-shrink-0">
            <i class="fas fa-times text-lg"></i>
          </button>
        </div>
        
        <!-- Event Type Badge -->
        <div class="mt-3">
          <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm font-bold border-2"
                [ngClass]="isPaid ? 'bg-amber-50 text-amber-800 border-amber-300' : 'bg-emerald-50 text-emerald-800 border-emerald-300'">
            <i class="fas" [ngClass]="isPaid ? 'fa-peso-sign' : 'fa-ticket-alt'"></i>
            {{ isPaid ? 'Paid Event - Payment Required' : 'Free Event - No Payment Needed' }}
          </span>
        </div>
      </div>

      <!-- Scrollable Content -->
      <div class="modal-content-scroll flex-1 overflow-y-auto px-6 py-5 space-y-6">
        <!-- Personal Information Section -->
        <div>
          <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wide mb-3 flex items-center gap-2">
            <i class="fas fa-user text-[#679436]"></i>
            Personal Information
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label for="firstName" class="block text-sm font-semibold text-gray-700 mb-1">First Name</label>
              <input type="text" id="firstName" name="firstName" [(ngModel)]="studentInfo.first_name"
                class="w-full border-2 border-gray-300 rounded-lg shadow-sm px-3 py-2 bg-gray-50 text-gray-600 focus:outline-none focus:ring-2 focus:ring-[#679436] focus:border-[#679436]" required readonly>
            </div>
            <div>
              <label for="surname" class="block text-sm font-semibold text-gray-700 mb-1">Surname</label>
              <input type="text" id="surname" name="surname" [(ngModel)]="studentInfo.last_name"
                class="w-full border-2 border-gray-300 rounded-lg shadow-sm px-3 py-2 bg-gray-50 text-gray-600 focus:outline-none focus:ring-2 focus:ring-[#679436] focus:border-[#679436]" required readonly>
            </div>
            <div>
              <label for="middleInitial" class="block text-sm font-semibold text-gray-700 mb-1">Middle Initial</label>
              <input type="text" id="middleInitial" name="middleInitial" [(ngModel)]="studentInfo.middle_initial"
                class="w-full border-2 border-gray-300 rounded-lg shadow-sm px-3 py-2 bg-gray-50 text-gray-600 focus:outline-none focus:ring-2 focus:ring-[#679436] focus:border-[#679436]" readonly>
            </div>
            <div>
              <label for="suffix" class="block text-sm font-semibold text-gray-700 mb-1">Suffix</label>
              <select id="suffix" name="suffix" [(ngModel)]="studentInfo.suffix"
                class="w-full border-2 border-gray-300 rounded-lg shadow-sm px-3 py-2 bg-gray-50 text-gray-600 focus:outline-none focus:ring-2 focus:ring-[#679436] focus:border-[#679436]" disabled>
                <option value="">Select</option>
                <option value="Jr">Jr</option>
                <option value="Sr">Sr</option>
                <option value="II">II</option>
                <option value="III">III</option>
                <option value="IV">IV</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Academic Information Section -->
        <div>
          <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wide mb-3 flex items-center gap-2">
            <i class="fas fa-graduation-cap text-[#679436]"></i>
            Academic Information
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label for="studentId" class="block text-sm font-semibold text-gray-700 mb-1">Student ID</label>
              <input type="text" id="studentId" name="studentId" [(ngModel)]="registrationData.student_id"
                class="w-full border-2 border-gray-300 rounded-lg shadow-sm px-3 py-2 bg-gray-50 text-gray-600 focus:outline-none focus:ring-2 focus:ring-[#679436] focus:border-[#679436]" required readonly>
            </div>
            <div>
              <label for="domainEmail" class="block text-sm font-semibold text-gray-700 mb-1">Email Address</label>
              <input type="email" id="domainEmail" name="domainEmail" [(ngModel)]="studentInfo.email"
                class="w-full border-2 border-gray-300 rounded-lg shadow-sm px-3 py-2 bg-gray-50 text-gray-600 focus:outline-none focus:ring-2 focus:ring-[#679436] focus:border-[#679436]" required readonly>
            </div>
            <div>
              <label for="department" class="block text-sm font-semibold text-gray-700 mb-1">Department</label>
              <select id="department" name="department" [(ngModel)]="studentInfo.department"
                class="w-full border-2 border-gray-300 rounded-lg shadow-sm px-3 py-2 bg-gray-50 text-gray-600 focus:outline-none focus:ring-2 focus:ring-[#679436] focus:border-[#679436]" disabled>
                <option value="">Select</option>
                <option value="CAHS">CAHS</option>
                <option value="CBA">CBA</option>
                <option value="CCS">CCS</option>
                <option value="CEAS">CEAS</option>
                <option value="CHTM">CHTM</option>
              </select>
            </div>
            <div>
              <label for="program" class="block text-sm font-semibold text-gray-700 mb-1">Program</label>
              <input type="text" id="program" name="program" [(ngModel)]="studentInfo.program"
                class="w-full border-2 border-gray-300 rounded-lg shadow-sm px-3 py-2 bg-gray-50 text-gray-600 focus:outline-none focus:ring-2 focus:ring-[#679436] focus:border-[#679436]" required readonly>
            </div>
          </div>
        </div>

        <!-- Proof of Payment Section -->
        <div>
          <h3 class="text-sm font-bold uppercase tracking-wide mb-3 flex items-center gap-2"
              [ngClass]="isPaid ? 'text-amber-700' : 'text-gray-500'">
            <i class="fas fa-receipt" [ngClass]="isPaid ? 'text-amber-600' : 'text-[#679436]'"></i>
            Proof of Payment
            <span *ngIf="isPaid" class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-bold bg-red-100 text-red-700 border border-red-300">
              Required
            </span>
            <span *ngIf="!isPaid" class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-bold bg-gray-100 text-gray-600 border border-gray-300">
              Not Required
            </span>
          </h3>
          
          <div *ngIf="isPaid" class="mb-3 p-3 bg-amber-50 border-2 border-amber-200 rounded-lg">
            <p class="text-sm text-amber-800 flex items-start gap-2">
              <i class="fas fa-info-circle mt-0.5 flex-shrink-0"></i>
              <span>Please upload your proof of payment (PNG, JPG, JPEG, or WebP format, maximum 2MB file size)</span>
            </p>
          </div>

          <div *ngIf="!isPaid" class="mb-3 p-3 bg-emerald-50 border-2 border-emerald-200 rounded-lg">
            <p class="text-sm text-emerald-800 flex items-start gap-2">
              <i class="fas fa-check-circle mt-0.5 flex-shrink-0"></i>
              <span>This is a free event. You don't need to upload a proof of payment.</span>
            </p>
          </div>

          <div class="flex items-center justify-center w-full">
            <div class="flex flex-col items-center justify-center w-full">
              <!-- Dropzone -->
              <label for="pop-dropzone-file" 
                class="flex flex-col items-center justify-center w-full h-56 border-2 border-dashed rounded-xl cursor-pointer transition-all duration-200"
                [ngClass]="isPaid ? 'border-amber-300 bg-amber-50/30 hover:bg-amber-50 hover:border-amber-400' : 'border-gray-300 bg-gray-50 opacity-50 cursor-not-allowed'"
                *ngIf="!proofPreviewUrl">
                <div class="flex flex-col items-center justify-center pt-5 pb-6">
                  <div class="w-16 h-16 mb-4 rounded-full flex items-center justify-center"
                       [ngClass]="isPaid ? 'bg-amber-100' : 'bg-gray-200'">
                    <i class="fas fa-cloud-upload-alt text-2xl" [ngClass]="isPaid ? 'text-amber-600' : 'text-gray-400'"></i>
                  </div>
                  <p class="mb-2 text-sm font-semibold" [ngClass]="isPaid ? 'text-amber-700' : 'text-gray-500'">
                    <span>Click to upload</span> or drag and drop
                  </p>
                  <p class="text-xs" [ngClass]="isPaid ? 'text-amber-600' : 'text-gray-400'">PNG, JPG, JPEG, WEBP (Max: 2MB)</p>
                </div>
                <input id="pop-dropzone-file" type="file" class="hidden" accept="image/png,image/jpeg,image/jpg,image/webp" 
                  (change)="previewImages($event)" [disabled]="!isPaid" />
              </label>

              <!-- Preview Card -->
              <div class="w-full" *ngIf="proofPreviewUrl">
                <div class="relative rounded-xl border-2 border-amber-300 shadow-lg bg-white p-3">
                  <div class="absolute top-2 right-2 z-10">
                    <button type="button" (click)="removeImage()" 
                      class="w-8 h-8 flex items-center justify-center bg-white text-red-600 hover:bg-red-50 border-2 border-red-300 rounded-full shadow-md transition-all" 
                      aria-label="Remove image">
                      <i class="fas fa-times text-sm"></i>
                    </button>
                  </div>
                  <img [src]="proofPreviewUrl" class="w-full max-h-72 object-contain rounded-lg" alt="Proof preview" />
                  <div class="mt-2 p-2 bg-emerald-50 border-2 border-emerald-300 rounded-lg">
                    <p class="text-xs text-emerald-800 font-semibold flex items-center gap-2">
                      <i class="fas fa-check-circle"></i>
                      Proof of payment uploaded successfully
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="px-6 py-4 border-t-2 border-gray-200 bg-gray-50">
        <div class="flex justify-end gap-3">
          <button type="button" (click)="closeModal()"
            class="px-6 py-2.5 rounded-lg border-2 border-gray-300 bg-white hover:bg-gray-100 text-gray-700 font-semibold transition-all duration-200 shadow-sm hover:shadow-md">
            Cancel
          </button>
          <button type="submit"
            class="px-6 py-2.5 rounded-lg bg-[#679436] hover:bg-[#56732e] text-white font-semibold transition-all duration-200 shadow-md hover:shadow-lg border-2 border-[#679436] flex items-center gap-2">
            <span>Register</span>
          </button>
        </div>
      </div>
    </form>
  </div>
</div>
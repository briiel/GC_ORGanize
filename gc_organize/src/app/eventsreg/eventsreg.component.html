<div class="p-6 bg-gray-100 min-h-screen">
  <!-- Header Section -->
  <div class="mb-6 mx-2 lg:mx-6">
    <div class="flex flex-col sm:flex-row sm:items-center gap-3 justify-between">
      <h1 class="text-2xl sm:text-3xl font-bold mb-2 leading-tight break-words max-w-full text-[#679436]">
        Events Registered
      </h1>
    </div>
  </div>

  <!-- Search Section -->
  <div class="mb-6 mx-2 lg:mx-6">
    <div class="flex flex-col sm:flex-row gap-3 sm:items-center">
      <div class="relative flex-1 sm:flex-none sm:max-w-md flex gap-2">
        <input
          type="text"
          [(ngModel)]="searchTerm"
          placeholder="Search by event name or location..."
          class="flex-1 px-4 py-2.5 rounded-lg border-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#679436] focus:border-[#679436] transition-all shadow-sm"
          (keyup.enter)="onSearch()"
        />
        <button
          class="px-5 py-2.5 bg-[#679436] hover:bg-[#56732e] text-white rounded-lg text-sm font-semibold transition-all duration-200 shadow-md hover:shadow-lg border-2 border-[#679436] flex items-center gap-2"
          (click)="onSearch()"
        >
          <i class="fas fa-search"></i>
          <span class="hidden sm:inline">Search</span>
        </button>
        <button
          *ngIf="searchTerm"
          class="px-4 py-2.5 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg text-sm font-semibold transition-all duration-200 shadow-sm hover:shadow-md border-2 border-gray-300 flex items-center gap-2"
          (click)="clearSearch()"
        >
          <i class="fas fa-times"></i>
          <span class="hidden sm:inline">Clear</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Events Table -->
  <div class="mx-2 lg:mx-6 mb-10 overflow-hidden rounded-2xl shadow-xl bg-white border-2 border-gray-200">
    <!-- Enhanced Header with Gradient -->
    <div class="px-6 py-3 border-b-4 bg-[#679436] border-[#679436]">
      <div class="flex items-center gap-3">
        <div class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center flex-shrink-0">
          <i class="fas fa-calendar-check text-white text-sm"></i>
        </div>
        <h2 class="text-lg lg:text-xl font-bold text-white">
          My Registered Events
        </h2>
      </div>
    </div>

    <div class="overflow-x-auto">
      <table class="w-full text-sm lg:text-base">
        <thead class="bg-[#679436]">
          <tr class="uppercase tracking-wider text-white text-xs lg:text-sm">
            <th class="px-4 py-4 text-center w-12 font-bold">#</th>
            <th class="px-4 py-4 text-center min-w-[180px] font-bold">Title</th>
            <th class="px-4 py-4 text-center font-bold">Type</th>
            <th class="px-4 py-4 text-center font-bold">Organized By</th>
            <th class="px-4 py-4 text-center font-bold">Date</th>
            <th class="px-4 py-4 text-center font-bold">Time</th>
            <th class="px-4 py-4 text-center min-w-[120px] font-bold">Location</th>
            <th class="px-4 py-4 text-center font-bold">QR Code</th>
          </tr>
        </thead>
        <tbody class="bg-white text-gray-800 divide-y divide-gray-200">
          <!-- Loading State -->
          <tr *ngIf="loading">
            <td colspan="8" class="px-4 py-12 text-center">
              <div class="flex flex-col items-center gap-3">
                <i class="fas fa-spinner fa-spin text-3xl text-[#679436]"></i>
                <p class="text-gray-600">Loading your registered events...</p>
              </div>
            </td>
          </tr>

          <!-- Empty State -->
          <tr *ngIf="!loading && filteredEvents.length === 0">
            <td colspan="8" class="px-4 py-12 text-center">
              <div class="flex flex-col items-center gap-3">
                <i class="fas fa-calendar-times text-5xl text-gray-400"></i>
                <h3 class="text-lg font-medium text-gray-900">No registered events yet</h3>
                <p class="text-gray-500">Register for events to see them here!</p>
              </div>
            </td>
          </tr>

          <!-- Event Rows -->
          <tr *ngFor="let event of filteredEvents; let i = index" class="hover:bg-green-50/50 transition-all duration-200">
            <td class="px-4 py-4 text-center text-[#679436] font-bold text-base">{{ i + 1 }}</td>
            <td class="px-4 py-4 font-semibold text-center max-w-[200px]">
              <div class="text-[#679436] font-semibold truncate" [title]="event.title">{{ event.title }}</div>
            </td>
            <td class="px-4 py-4 text-center">
              <div class="flex flex-col gap-1.5">
                <span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-bold border-2 justify-center"
                      [ngClass]="event.is_paid ? 'bg-amber-50 text-amber-800 border-amber-300' : 'bg-emerald-50 text-emerald-800 border-emerald-300'">
                  <i class="fas text-xs" [ngClass]="event.is_paid ? 'fa-peso-sign' : 'fa-ticket-alt'"></i>
                  {{ event.is_paid ? 'Paid' : 'Free' }}
                </span>
                <span *ngIf="event.is_paid && (event.registration_fee ?? 0) > 0"
                      class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-bold border-2 bg-amber-50 text-amber-900 border-amber-300 justify-center">
                  <i class="fas fa-peso-sign text-xs"></i>
                  {{ event.registration_fee | number:'1.2-2' }}
                </span>
              </div>
            </td>
            <td class="px-4 py-4 text-center">
              <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-bold text-white border-2"
                    [ngClass]="{
                      'bg-orange-500 border-orange-600': event.department === 'CCS',
                      'bg-yellow-400 border-yellow-500': event.department === 'CBA',
                      'bg-red-500 border-red-600': event.department === 'CAHS',
                      'bg-blue-500 border-blue-600': event.department === 'CEAS',
                      'bg-pink-400 border-pink-500': event.department === 'CHTM',
                      'bg-[#679436] border-[#56732e]': !event.department || event.department === 'OSWS'
                    }">
                {{ event.department ? event.department : 'OSWS' }}
              </span>
            </td>
            <td class="px-4 py-4 text-center text-sm">
              <div class="flex flex-col gap-1">
                <span class="font-medium">{{ event.start_date | date: 'MMM d, y' }}</span>
                <span *ngIf="event.end_date && event.end_date !== event.start_date" class="text-gray-500 text-xs">to {{ event.end_date | date: 'MMM d, y' }}</span>
              </div>
            </td>
            <td class="px-4 py-4 text-center text-sm">
              <div class="flex flex-col gap-1">
                <span class="font-medium">{{ formatTime(event.start_time) }}</span>
                <span *ngIf="event.end_time" class="text-gray-500 text-xs">to {{ formatTime(event.end_time) }}</span>
              </div>
            </td>
            <td class="px-4 py-4 text-center max-w-[160px]">
              <div class="flex items-center gap-2 justify-center">
                <i class="fas fa-map-marker-alt text-gray-400 text-xs"></i>
                <span class="truncate text-sm" [title]="event.location">{{ event.location }}</span>
              </div>
            </td>
            <td class="px-4 py-4 text-center">
              <div class="flex flex-col items-center gap-2">
                <button *ngIf="event.qr_code && (event.registration_status || 'approved') === 'approved'"
                        (click)="downloadQrCode(event.qr_code, event.event_id)"
                        class="bg-[#679436] hover:bg-[#56732e] text-white inline-flex items-center justify-center px-4 py-2 rounded-lg text-sm font-semibold transition-all duration-200 shadow-md hover:shadow-lg border-2 border-[#679436]"
                        [attr.aria-label]="'Download QR Code'">
                  <i class="fas fa-download mr-2"></i>
                  <span>Download</span>
                </button>
                <span *ngIf="(event.registration_status || 'approved') === 'pending'"
                      class="inline-flex items-center px-3 py-1.5 rounded-lg text-xs font-bold bg-yellow-50 text-yellow-800 border-2 border-yellow-300">
                  <i class="fas fa-clock mr-1.5"></i>
                  Pending Approval
                </span>
                <span *ngIf="(event.registration_status || '') === 'rejected'"
                      class="inline-flex items-center px-3 py-1.5 rounded-lg text-xs font-bold bg-red-50 text-red-800 border-2 border-red-300">
                  <i class="fas fa-times-circle mr-1.5"></i>
                  Rejected
                </span>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

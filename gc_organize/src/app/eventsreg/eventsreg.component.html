<div class="p-2 sm:p-4 lg:p-6 bg-gray-100 min-h-screen">
  <!-- Header -->
  <div class="mb-3 sm:mb-4 lg:mb-6 mx-0 sm:mx-1 lg:mx-4">
    <div class="bg-white rounded-lg sm:rounded-xl shadow-md p-3 sm:p-4 lg:p-5 border-l-4 border-[#679436]">
      <div class="flex items-center gap-2 sm:gap-3">
        <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-lg bg-[#679436] flex items-center justify-center flex-shrink-0">
          <i class="fas fa-calendar-check text-white text-base sm:text-lg"></i>
        </div>
        <div class="min-w-0">
          <h1 class="text-lg sm:text-xl lg:text-2xl font-bold text-gray-800 truncate">Events Registered</h1>
          <p class="text-xs sm:text-sm text-gray-600 truncate">View your registered events</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Search Section -->
  <div class="mb-3 sm:mb-4 lg:mb-6 mx-0 sm:mx-1 lg:mx-4">
    <div class="bg-white rounded-lg sm:rounded-xl shadow-md p-3 sm:p-4 lg:p-5">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4">
        <div>
          <label class="block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2">
            <i class="fas fa-search mr-1 text-xs sm:text-sm"></i>Search Events
          </label>
          <input
            type="text"
            [(ngModel)]="searchTerm"
            placeholder="Search events..."
            class="w-full px-3 sm:px-4 py-2.5 sm:py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#679436] focus:border-[#679436] transition-all text-sm sm:text-base min-h-[44px]"
            (keyup.enter)="onSearch()"
          />
        </div>
        <div>
          <label class="block text-xs sm:text-sm font-semibold text-gray-700 mb-1.5 sm:mb-2">
            <i class="fas fa-sort mr-1 text-xs sm:text-sm"></i>Sort By
          </label>
          <select [(ngModel)]="sortBy" (ngModelChange)="onSortChange()" class="w-full px-3 sm:px-4 py-2.5 sm:py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#679436] focus:border-[#679436] transition-all text-sm sm:text-base bg-white min-h-[44px]">
            <option value="date_desc">Latest Event</option>
            <option value="date_asc">Earliest Event</option>
            <option value="title_asc">Title (A-Z)</option>
            <option value="title_desc">Title (Z-A)</option>
          </select>
        </div>
      </div>
      <div *ngIf="searchTerm" class="mt-3 sm:mt-4">
        <button
          (click)="clearSearch()"
          class="w-full sm:w-auto px-4 py-2.5 sm:py-3 text-sm sm:text-base bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 active:bg-gray-300 transition-all duration-200 font-semibold border-2 border-gray-300 flex items-center justify-center gap-2 min-h-[44px]"
        >
          <i class="fas fa-times text-sm"></i>
          <span>Clear Search</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Events Table -->
  <div class="mx-0 sm:mx-1 lg:mx-4 mb-4 sm:mb-6 lg:mb-10">
    <div class="bg-white rounded-lg shadow-lg overflow-hidden border border-gray-200">
      <div class="overflow-x-auto -webkit-overflow-scrolling-touch" style="-webkit-overflow-scrolling: touch; overscroll-behavior-x: contain;">
        <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-[#679436]">
          <tr class="uppercase tracking-wider text-white text-[10px] sm:text-xs lg:text-sm">
            <th class="px-2 sm:px-3 lg:px-4 py-2 sm:py-2.5 lg:py-3 text-center w-10 sm:w-12 font-semibold">#</th>
            <th class="px-3 sm:px-4 py-2 sm:py-2.5 lg:py-3 text-center min-w-[140px] sm:min-w-[180px] font-semibold">Title</th>
            <th class="px-3 sm:px-4 py-2 sm:py-2.5 lg:py-3 text-center min-w-[80px] font-semibold">Type</th>
            <th class="px-3 sm:px-4 py-2 sm:py-2.5 lg:py-3 text-center min-w-[100px] font-semibold">Organized By</th>
            <th class="px-3 sm:px-4 py-2 sm:py-2.5 lg:py-3 text-center min-w-[110px] font-semibold">Date</th>
            <th class="px-3 sm:px-4 py-2 sm:py-2.5 lg:py-3 text-center min-w-[100px] font-semibold">Time</th>
            <th class="px-3 sm:px-4 py-2 sm:py-2.5 lg:py-3 text-center min-w-[110px] sm:min-w-[120px] font-semibold">Location</th>
            <th class="px-3 sm:px-4 py-2 sm:py-2.5 lg:py-3 text-center min-w-[110px] font-semibold">QR Code</th>
          </tr>
        </thead>
        <tbody class="bg-white text-gray-800 divide-y divide-gray-200">
          <!-- Loading State -->
          <tr *ngIf="loading">
            <td colspan="8" class="px-3 sm:px-4 py-8 sm:py-12 text-center">
              <div class="flex flex-col items-center gap-2 sm:gap-3">
                <i class="fas fa-spinner fa-spin text-2xl sm:text-3xl text-[#679436]"></i>
                <p class="text-sm sm:text-base text-gray-600">Loading your registered events...</p>
              </div>
            </td>
          </tr>

          <!-- Empty State -->
          <tr *ngIf="!loading && filteredEvents.length === 0">
            <td colspan="8" class="px-3 sm:px-4 py-8 sm:py-12 text-center">
              <div class="flex flex-col items-center gap-2 sm:gap-3">
                <i class="fas fa-calendar-times text-4xl sm:text-5xl text-gray-400"></i>
                <h3 class="text-base sm:text-lg font-medium text-gray-900">No registered events yet</h3>
                <p class="text-sm sm:text-base text-gray-500">Register for events to see them here!</p>
              </div>
            </td>
          </tr>

          <!-- Event Rows -->
          <tr *ngFor="let event of filteredEvents; let i = index" class="hover:bg-green-50/50 transition-all duration-200">
            <td class="px-2 sm:px-3 lg:px-4 py-2.5 sm:py-3 lg:py-3.5 text-center text-[#679436] font-semibold text-sm sm:text-base">{{ i + 1 }}</td>
            <td class="px-2 sm:px-3 lg:px-4 py-2.5 sm:py-3 lg:py-3.5 font-semibold text-center max-w-[160px] sm:max-w-[200px]">
              <div class="text-[#679436] font-semibold truncate text-xs sm:text-sm" [title]="event.title">{{ event.title }}</div>
            </td>
            <td class="px-2 sm:px-3 lg:px-4 py-2.5 sm:py-3 lg:py-3.5 text-center">
              <div class="flex flex-col gap-1 sm:gap-1.5">
                <span class="inline-flex items-center gap-1 sm:gap-1.5 px-2 py-1 rounded-full text-[10px] sm:text-xs font-bold border-2 justify-center"
                      [ngClass]="event.is_paid ? 'bg-amber-50 text-amber-800 border-amber-300' : 'bg-emerald-50 text-emerald-800 border-emerald-300'">
                  <i class="fas text-xs" [ngClass]="event.is_paid ? 'fa-peso-sign' : 'fa-ticket-alt'"></i>
                  {{ event.is_paid ? 'Paid' : 'Free' }}
                </span>
                <span *ngIf="event.is_paid && (event.registration_fee ?? 0) > 0"
                      class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-bold border-2 bg-amber-50 text-amber-900 border-amber-300 justify-center">
                  <i class="fas fa-peso-sign text-xs"></i>
                  {{ event.registration_fee | number:'1.2-2' }}
                </span>
              </div>
            </td>
            <td class="px-2 sm:px-3 lg:px-4 py-2.5 sm:py-3 lg:py-3.5 text-center">
              <span class="inline-flex items-center px-2 py-1 rounded-full text-[10px] sm:text-xs font-bold text-white border-2"
                    [ngClass]="{
                      'bg-orange-500 border-orange-600': event.department === 'CCS',
                      'bg-yellow-400 border-yellow-500': event.department === 'CBA',
                      'bg-red-500 border-red-600': event.department === 'CAHS',
                      'bg-blue-500 border-blue-600': event.department === 'CEAS',
                      'bg-pink-400 border-pink-500': event.department === 'CHTM',
                      'bg-[#679436] border-[#56732e]': !event.department || event.department === 'OSWS'
                    }">
                {{ event.department ? event.department : 'OSWS' }}
              </span>
            </td>
            <td class="px-2 sm:px-3 lg:px-4 py-2.5 sm:py-3 lg:py-3.5 text-center text-xs sm:text-sm">
              <div class="flex flex-col gap-0.5">
                <span class="font-medium">{{ event.start_date | date: 'MMM d, y' }}</span>
                <span *ngIf="event.end_date && event.end_date !== event.start_date" class="text-gray-500 text-[10px] sm:text-xs">to {{ event.end_date | date: 'MMM d, y' }}</span>
              </div>
            </td>
            <td class="px-2 sm:px-3 lg:px-4 py-2.5 sm:py-3 lg:py-3.5 text-center text-xs sm:text-sm">
              <div class="flex flex-col gap-0.5">
                <span class="font-medium">{{ formatTime(event.start_time) }}</span>
                <span *ngIf="event.end_time" class="text-gray-500 text-[10px] sm:text-xs">to {{ formatTime(event.end_time) }}</span>
              </div>
            </td>
            <td class="px-2 sm:px-3 lg:px-4 py-2.5 sm:py-3 lg:py-3.5 text-center max-w-[130px] sm:max-w-[160px]">
              <div class="flex items-center gap-1 sm:gap-1.5 justify-center">
                <i class="fas fa-map-marker-alt text-gray-400 text-[10px] sm:text-xs flex-shrink-0"></i>
                <span class="truncate text-xs sm:text-sm" [title]="event.room || event.location">{{ event.room || event.location }}</span>
              </div>
            </td>
            <td class="px-2 sm:px-3 lg:px-4 py-2.5 sm:py-3 lg:py-4 text-center">
              <div class="flex flex-col items-center gap-2">
                <button *ngIf="event.qr_code && (event.registration_status || 'approved') === 'approved'"
                        (click)="downloadQrCode(event.qr_code, event.event_id)"
                        class="bg-[#679436] hover:bg-[#56732e] active:bg-[#4a6827] text-white inline-flex items-center justify-center px-3 sm:px-4 py-2 sm:py-2.5 rounded-lg text-xs sm:text-sm font-semibold transition-all duration-200 shadow-md hover:shadow-lg border-2 border-[#679436] min-h-[44px] whitespace-nowrap"
                        [attr.aria-label]="'Download QR Code'">
                  <i class="fas fa-download mr-1.5 sm:mr-2 text-xs"></i>
                  <span>Download</span>
                </button>
                <span *ngIf="(event.registration_status || 'approved') === 'pending'"
                      class="inline-flex items-center px-2 sm:px-3 py-1 sm:py-1.5 rounded-lg text-[10px] sm:text-xs font-bold bg-yellow-50 text-yellow-800 border-2 border-yellow-300 whitespace-nowrap">
                  <i class="fas fa-clock mr-1 sm:mr-1.5 text-xs"></i>
                  Pending
                </span>
                <span *ngIf="(event.registration_status || '') === 'rejected'"
                      class="inline-flex items-center px-2 sm:px-3 py-1 sm:py-1.5 rounded-lg text-[10px] sm:text-xs font-bold bg-red-50 text-red-800 border-2 border-red-300 whitespace-nowrap">
                  <i class="fas fa-times-circle mr-1 sm:mr-1.5 text-xs"></i>
                  Declined
                </span>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

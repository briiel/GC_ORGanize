<div class="flex h-screen relative">
    <!-- Sidebar: always collapsible -->
        <!-- Mobile overlay backdrop -->
                <div 
                    class="fixed inset-0 bg-black/60 lg:hidden transition-all duration-300 z-30 backdrop-blur-sm"
                [class.opacity-100]="isSidebarOpen"
                [class.opacity-0]="!isSidebarOpen"
                [class.pointer-events-none]="!isSidebarOpen"
                (click)="closeIfMobile()"
                aria-hidden="true">
        </div>

    <div [class.translate-x-0]="isSidebarOpen" [class.-translate-x-full]="!isSidebarOpen"
        class="w-72 sm:w-80 lg:w-64 max-w-[90vw] flex flex-col fixed top-0 left-0 h-full transition-transform duration-300 ease-out z-40 shadow-2xl sidebar-blur-target"
        [ngClass]="{
            'bg-[#679436]': role !== 'osws_admin',
            'bg-[#14532d]': role === 'osws_admin'
         }"
        role="navigation"
        aria-label="Main navigation">
                    <!-- Close button (mobile only) -->
                    <button (click)="closeIfMobile()" 
                            class="lg:hidden absolute top-3 right-3 w-11 h-11 min-w-[44px] min-h-[44px] rounded-lg flex items-center justify-center bg-black/30 hover:bg-black/40 active:bg-black/50 text-white transition-all duration-200 z-50 focus:outline-none focus:ring-2 focus:ring-white/50"
                            aria-label="Close navigation menu">
                        <i class="fas fa-times text-base"></i>
                    </button>
        <div class="p-4 sm:p-5 lg:p-3 flex flex-col items-center space-y-3 sm:space-y-4 lg:space-y-2 mt-12 sm:mt-10 lg:mt-0 border-b border-white/10">
                                                <img 
                                                        src="/main_logo.webp" 
                            alt="GC-ORGANIZE Logo"
                            class="w-16 h-16 sm:w-20 sm:h-20 lg:w-12 lg:h-12 object-contain"
                        >
            <h1 class="text-base sm:text-lg lg:text-base font-bold text-center text-white tracking-tight">GC-ORGANIZE</h1>
            
            <!-- Panel Switcher with label (single role shows static label, multiple roles show dropdown) -->
            <div class="w-full">
                <!-- Static label for single role -->
                <div *ngIf="!hasMultiplePanels()" class="text-center py-1.5 px-3 rounded-md bg-black/10">
                    <span class="text-[10px] font-semibold tracking-widest uppercase text-white/80">
                        {{ getCurrentPanelLabel() }}
                    </span>
                </div>
                
                <!-- Dropdown for multiple roles -->
                <select 
                    *ngIf="hasMultiplePanels()"
                    [(ngModel)]="role"
                    (ngModelChange)="switchPanel($event)"
                    class="w-full px-3 py-2 rounded-md text-[10px] font-semibold uppercase tracking-wider cursor-pointer transition-all duration-200 text-center focus:outline-none focus:ring-2 focus:ring-white/30 bg-black/10 hover:bg-black/20 text-white border border-white/10"
                >
                    <option 
                        *ngFor="let panel of availablePanels" 
                        [value]="panel.role" 
                        class="bg-gray-900 text-white"
                    >
                        {{ panel.label }}
                    </option>
                </select>
            </div>
        </div>
        <nav class="flex-1 px-3 sm:px-4 lg:px-3 py-3 sm:py-4 lg:py-2 w-full space-y-1 lg:space-y-0.5 overflow-y-auto overscroll-contain" 
             [ngClass]="{ 'org-panel-text-sm': role === 'organization', 'osws-panel': role === 'osws_admin' }"
             style="-webkit-overflow-scrolling: touch;">
            <!-- Student Buttons -->
            <ng-container *ngIf="role === 'student'">
                <button routerLink="/student-dashboard/home" routerLinkActive="sidebar-item-active" (click)="closeIfMobile()"
                    class="flex items-center gap-3 px-3 sm:px-4 py-3 sm:py-3.5 text-sm sm:text-base lg:text-sm font-medium text-white rounded-lg hover:bg-black/20 active:bg-black/30 w-full cursor-pointer transition-all duration-200 group min-h-[44px]">
                    <i class="fas fa-home text-sm sm:text-base lg:text-sm w-4 sm:w-5 lg:w-4 text-center"></i>
                    <span>Home</span>
                </button>
                <button routerLink="/student-dashboard/eventsreg" routerLinkActive="sidebar-item-active" (click)="closeIfMobile()"
                    class="flex items-center gap-3 px-3 sm:px-4 py-3 sm:py-3.5 text-sm sm:text-base lg:text-sm font-medium text-white rounded-lg hover:bg-black/20 active:bg-black/30 w-full cursor-pointer transition-all duration-200 group min-h-[44px]">
                    <i class="fas fa-calendar-check text-sm sm:text-base lg:text-sm w-4 sm:w-5 lg:w-4 text-center"></i>
                    <span>Events Registered</span>
                </button>
                <button routerLink="/student-dashboard/history" routerLinkActive="sidebar-item-active" (click)="closeIfMobile()"
                    class="flex items-center gap-3 px-3 sm:px-4 py-3 sm:py-3.5 text-sm sm:text-base lg:text-sm font-medium text-white rounded-lg hover:bg-black/20 active:bg-black/30 w-full cursor-pointer transition-all duration-200 group min-h-[44px]">
                    <i class="fas fa-history text-sm sm:text-base lg:text-sm w-4 sm:w-5 lg:w-4 text-center"></i>
                    <span>Events Attended</span>
                </button>
                <button routerLink="/student-dashboard/ecertificate" routerLinkActive="sidebar-item-active" (click)="closeIfMobile()"
                    class="flex items-center gap-3 px-3 sm:px-4 py-3 sm:py-3.5 text-sm sm:text-base lg:text-sm font-medium text-white rounded-lg hover:bg-black/20 active:bg-black/30 w-full cursor-pointer transition-all duration-200 group min-h-[44px]">
                    <i class="fas fa-certificate text-sm sm:text-base lg:text-sm w-4 sm:w-5 lg:w-4 text-center"></i>
                    <span>E-Certificate</span>
                </button>
                <button routerLink="/student-dashboard/request-role" routerLinkActive="sidebar-item-active" (click)="closeIfMobile()"
                    class="flex items-center gap-3 px-3 sm:px-4 py-3 sm:py-3.5 text-sm sm:text-base lg:text-sm font-medium text-white rounded-lg hover:bg-black/20 active:bg-black/30 w-full cursor-pointer transition-all duration-200 group min-h-[44px]">
                    <i class="fas fa-user-plus text-sm sm:text-base lg:text-sm w-4 sm:w-5 lg:w-4 text-center"></i>
                    <span>Request Role</span>
                </button>
                <!-- Logout Button -->
                <div class="pt-3 sm:pt-3 lg:pt-2 mt-3 sm:mt-3 lg:mt-2 border-t border-white/10">
                    <button (click)="onLogout(); closeIfMobile()"
                        class="flex items-center gap-3 px-3 sm:px-4 py-3 sm:py-3.5 lg:py-2.5 text-sm sm:text-base lg:text-sm font-medium text-white rounded-lg hover:bg-red-600/30 active:bg-red-600/40 w-full cursor-pointer transition-all duration-200 group min-h-[44px] lg:min-h-[40px]">
                        <i class="fas fa-sign-out-alt text-sm sm:text-base lg:text-sm w-4 sm:w-5 lg:w-4 text-center"></i>
                        <span>Logout</span>
                    </button>
                </div>
            </ng-container>

            <!-- Organization Buttons -->
            <ng-container *ngIf="role === 'organization'">
                <button [routerLink]="'dashboard'" routerLinkActive="sidebar-item-active" (click)="closeIfMobile()"
                    class="flex items-center gap-3 px-3 sm:px-4 py-3 sm:py-3.5 lg:py-2.5 text-sm sm:text-base lg:text-sm font-medium text-white rounded-lg hover:bg-black/20 active:bg-black/30 w-full cursor-pointer transition-all duration-200 group min-h-[44px] lg:min-h-[40px]">
                    <i class="fas fa-tachometer-alt text-sm sm:text-base lg:text-sm w-4 sm:w-5 lg:w-4 text-center"></i>
                    <span>Dashboard</span>
                </button>
                <button [routerLink]="'manage-event'" routerLinkActive="sidebar-item-active" (click)="closeIfMobile()"
                    class="flex items-center gap-3 px-3 sm:px-4 py-3 sm:py-3.5 lg:py-2.5 text-sm sm:text-base lg:text-sm font-medium text-white rounded-lg hover:bg-black/20 active:bg-black/30 w-full cursor-pointer transition-all duration-200 group min-h-[44px] lg:min-h-[40px]">
                    <i class="fas fa-tasks text-sm sm:text-base lg:text-sm w-4 sm:w-5 lg:w-4 text-center"></i>
                    <span>Manage Events</span>
                </button>
                <button [routerLink]="'members'" routerLinkActive="sidebar-item-active" (click)="closeIfMobile()"
                    class="flex items-center gap-3 px-3 sm:px-4 py-3 sm:py-3.5 lg:py-2.5 text-sm sm:text-base lg:text-sm font-medium text-white rounded-lg hover:bg-black/20 active:bg-black/30 w-full cursor-pointer transition-all duration-200 group min-h-[44px] lg:min-h-[40px]">
                    <i class="fas fa-users text-sm sm:text-base lg:text-sm w-4 sm:w-5 lg:w-4 text-center"></i>
                    <span>Members</span>
                </button>
                <button [routerLink]="'scan-qr'" routerLinkActive="sidebar-item-active" (click)="closeIfMobile()"
                    class="flex items-center gap-3 px-3 sm:px-4 py-3 sm:py-3.5 lg:py-2.5 text-sm sm:text-base lg:text-sm font-medium text-white rounded-lg hover:bg-black/20 active:bg-black/30 w-full cursor-pointer transition-all duration-200 group min-h-[44px] lg:min-h-[40px]">
                    <i class="fas fa-qrcode text-sm sm:text-base lg:text-sm w-4 sm:w-5 lg:w-4 text-center"></i>
                    <span>Scan QR</span>
                </button>
                <!-- Combined Requests & Records Dropdown -->
                <div class="w-full">
                    <button (click)="toggleRequests()" [class.sidebar-item-active]="isRequestsOpen"
                        class="flex items-center justify-between gap-3 px-3 sm:px-4 py-3 sm:py-3.5 lg:py-2.5 text-sm sm:text-base lg:text-sm font-medium text-white rounded-lg hover:bg-black/20 active:bg-black/30 w-full cursor-pointer transition-all duration-200 group min-h-[44px] lg:min-h-[40px]">
                        <span class="flex items-center gap-3">
                            <i class="fas fa-folder-open text-sm sm:text-base lg:text-sm w-4 sm:w-5 lg:w-4 text-center"></i>
                            <span>Requests & Records</span>
                        </span>
                        <i class="fas transition-transform duration-200 text-xs" 
                           [ngClass]="isRequestsOpen ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                    </button>
                    <div *ngIf="isRequestsOpen" class="ml-6 sm:ml-7 lg:ml-5 mt-1 lg:mt-0.5 space-y-1 lg:space-y-0.5 overflow-hidden transition-all duration-200">
                        <button [routerLink]="'certificate-requests'" routerLinkActive="sidebar-item-active" (click)="closeIfMobile()"
                            class="flex items-center gap-2.5 px-3 py-2.5 sm:py-3 lg:py-2 text-xs sm:text-sm lg:text-xs font-medium text-white/90 rounded-md hover:bg-black/15 active:bg-black/25 w-full cursor-pointer transition-all duration-200 group min-h-[44px] lg:min-h-[36px]">
                            <i class="fas fa-certificate text-xs sm:text-sm lg:text-xs w-3.5 text-center"></i>
                            <span>Certificate Requests</span>
                        </button>
                        <button [routerLink]="'attendance-records'" routerLinkActive="sidebar-item-active" (click)="closeIfMobile()"
                            class="flex items-center gap-2.5 px-3 py-2.5 sm:py-3 lg:py-2 text-xs sm:text-sm lg:text-xs font-medium text-white/90 rounded-md hover:bg-black/15 active:bg-black/25 w-full cursor-pointer transition-all duration-200 group min-h-[44px] lg:min-h-[36px]">
                            <i class="fas fa-list-alt text-xs sm:text-sm lg:text-xs w-3.5 text-center"></i>
                            <span>Attendance Records</span>
                        </button>
                    </div>
                </div>
                <button [routerLink]="'trash'" routerLinkActive="sidebar-item-active" (click)="closeIfMobile()"
                    class="flex items-center gap-3 px-3 sm:px-4 py-3 sm:py-3.5 lg:py-2.5 text-sm sm:text-base lg:text-sm font-medium text-white rounded-lg hover:bg-black/20 active:bg-black/30 w-full cursor-pointer transition-all duration-200 group min-h-[44px] lg:min-h-[40px]">
                    <i class="fas fa-trash text-sm sm:text-base lg:text-sm w-4 sm:w-5 lg:w-4 text-center"></i>
                    <span>Archive</span>
                </button>
                <!-- Logout Button -->
                <div class="pt-3 sm:pt-3 lg:pt-2 mt-3 sm:mt-3 lg:mt-2 border-t border-white/10">
                    <button (click)="onLogout(); closeIfMobile()"
                        class="flex items-center gap-3 px-3 sm:px-4 py-3 sm:py-3.5 text-sm sm:text-base lg:text-sm font-medium text-white rounded-lg hover:bg-red-600/30 active:bg-red-600/40 w-full cursor-pointer transition-all duration-200 group min-h-[44px]">
                        <i class="fas fa-sign-out-alt text-sm sm:text-base lg:text-sm w-4 sm:w-5 lg:w-4 text-center"></i>
                        <span>Logout</span>
                    </button>
                </div>
            </ng-container>

            <!-- OSWS Admin Buttons -->
            <ng-container *ngIf="role === 'osws_admin'">
                <button [routerLink]="'dashboard'" routerLinkActive="sidebar-item-active" (click)="closeIfMobile()"
                    class="flex items-center gap-3 px-3 sm:px-4 py-3 sm:py-3.5 text-sm sm:text-base lg:text-sm font-medium text-white rounded-lg hover:bg-black/20 active:bg-black/30 w-full cursor-pointer transition-all duration-200 group min-h-[44px]">
                    <i class="fas fa-tachometer-alt text-sm sm:text-base lg:text-sm w-4 sm:w-5 lg:w-4 text-center"></i>
                    <span>Dashboard</span>
                </button>
                
                <!-- User Management Dropdown -->
                <div class="w-full">
                    <button (click)="toggleUserManagement()" [class.sidebar-item-active]="isUserManagementOpen"
                        class="flex items-center justify-between gap-3 px-3 sm:px-4 py-3 sm:py-3.5 text-sm sm:text-base lg:text-sm font-medium text-white rounded-lg hover:bg-black/20 active:bg-black/30 w-full cursor-pointer transition-all duration-200 group min-h-[44px]">
                        <span class="flex items-center gap-3">
                            <i class="fas fa-users-cog text-sm sm:text-base lg:text-sm w-4 sm:w-5 lg:w-4 text-center"></i>
                            <span>User Management</span>
                        </span>
                        <i class="fas transition-transform duration-200 text-xs" 
                           [ngClass]="isUserManagementOpen ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                    </button>
                    
                    <!-- Dropdown Menu -->
                    <div *ngIf="isUserManagementOpen" 
                         class="ml-6 sm:ml-7 mt-1 space-y-1 overflow-hidden transition-all duration-200">
                        <button [routerLink]="'manage-users'" routerLinkActive="sidebar-item-active" (click)="closeIfMobile()"
                            class="flex items-center gap-2.5 px-3 py-2.5 sm:py-3 text-xs sm:text-sm lg:text-xs font-medium text-white/90 rounded-md hover:bg-black/15 active:bg-black/25 w-full cursor-pointer transition-all duration-200 group min-h-[44px]">
                            <i class="fas fa-users text-xs sm:text-sm lg:text-xs w-3.5 text-center"></i>
                            <span>Accounts</span>
                        </button>
                        <button [routerLink]="'role-requests'" routerLinkActive="sidebar-item-active" (click)="closeIfMobile()"
                            class="flex items-center gap-2.5 px-3 py-2.5 sm:py-3 text-xs sm:text-sm lg:text-xs font-medium text-white/90 rounded-md hover:bg-black/15 active:bg-black/25 w-full cursor-pointer transition-all duration-200 group min-h-[44px]">
                            <i class="fas fa-user-check text-xs sm:text-sm lg:text-xs w-3.5 text-center"></i>
                            <span>Role Requests</span>
                        </button>
                    </div>
                </div>
                
                <button [routerLink]="'manage-event'" routerLinkActive="sidebar-item-active" (click)="closeIfMobile()"
                    class="flex items-center gap-3 px-3 sm:px-4 py-3 sm:py-3.5 text-sm sm:text-base lg:text-sm font-medium text-white rounded-lg hover:bg-black/20 active:bg-black/30 w-full cursor-pointer transition-all duration-200 group min-h-[44px]">
                    <i class="fas fa-calendar-alt text-sm sm:text-base lg:text-sm w-4 sm:w-5 lg:w-4 text-center"></i>
                    <span>Manage Events</span>
                </button>
                <button [routerLink]="'scan-qr'" routerLinkActive="sidebar-item-active" (click)="closeIfMobile()"
                    class="flex items-center gap-3 px-3 sm:px-4 py-3 sm:py-3.5 text-sm sm:text-base lg:text-sm font-medium text-white rounded-lg hover:bg-black/20 active:bg-black/30 w-full cursor-pointer transition-all duration-200 group min-h-[44px]">
                    <i class="fas fa-qrcode text-sm sm:text-base lg:text-sm w-4 sm:w-5 lg:w-4 text-center"></i>
                    <span>Scan QR</span>
                </button>
                <!-- Attendance Records (OSWS admin only) -->
                <button [routerLink]="'attendance-records'" routerLinkActive="sidebar-item-active" (click)="closeIfMobile()"
                    class="flex items-center gap-3 px-3 sm:px-4 py-3 sm:py-3.5 text-sm sm:text-base lg:text-sm font-medium text-white rounded-lg hover:bg-black/20 active:bg-black/30 w-full cursor-pointer transition-all duration-200 group min-h-[44px]">
                    <i class="fas fa-list-alt text-sm sm:text-base lg:text-sm w-4 sm:w-5 lg:w-4 text-center"></i>
                    <span>Attendance Records</span>
                </button>
                <button [routerLink]="'trash'" routerLinkActive="sidebar-item-active" (click)="closeIfMobile()"
                    class="flex items-center gap-3 px-3 sm:px-4 py-3 sm:py-3.5 text-sm sm:text-base lg:text-sm font-medium text-white rounded-lg hover:bg-black/20 active:bg-black/30 w-full cursor-pointer transition-all duration-200 group min-h-[44px]">
                    <i class="fas fa-trash text-sm sm:text-base lg:text-sm w-4 sm:w-5 lg:w-4 text-center"></i>
                    <span>Archive</span>
                </button>
                <!-- Logout Button -->
                <div class="pt-3 mt-3 border-t border-white/10">
                    <button (click)="onLogout(); closeIfMobile()"
                        class="flex items-center gap-3 px-3 sm:px-4 py-3 sm:py-3.5 text-sm sm:text-base lg:text-sm font-medium text-white rounded-lg hover:bg-red-600/30 active:bg-red-600/40 w-full cursor-pointer transition-all duration-200 group min-h-[44px]">
                        <i class="fas fa-sign-out-alt text-sm sm:text-base lg:text-sm w-4 sm:w-5 lg:w-4 text-center"></i>
                        <span>Logout</span>
                    </button>
                </div>
            </ng-container>
        </nav>
    </div>

    <!-- Main Content Area: only shift on large screens when sidebar is open -->
                <div class="flex-1 relative panel-content overflow-y-auto h-screen transition-all duration-300 lg:blur-none"
                    [ngClass]="{ 'content-shift': isSidebarOpen, 'blur-sm': isSidebarOpen && isMobile, 'fading': panelFading }"
                    [@routeAnimations]="prepareRoute(outlet)">
    
        <!-- Sticky Navbar/Header -->
    <div class="sticky top-0 left-0 w-full flex items-center justify-between bg-white shadow-md px-3 sm:px-4 lg:px-6 py-2.5 sm:py-3 z-10"
             style="min-height: 56px;">
            <!-- Left: Menu Button (always visible) -->
            <button
              (click)="toggleSidebar()"
              class="text-gray-600 w-11 h-11 min-w-[44px] min-h-[44px] flex items-center justify-center rounded-lg hover:bg-gray-100 active:bg-gray-200 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-[#679436]/30"
              aria-label="Toggle navigation menu"
            >
              <i class="fas fa-bars text-lg sm:text-xl"></i>
            </button>
            <!-- Right: Actions (date, user, etc.) -->
            <div class="flex items-center space-x-2 sm:space-x-3 lg:space-x-4 min-w-0">
                <span class="text-gray-600 text-xs sm:text-sm truncate flex items-center" [title]="today | date:'fullDate'" aria-label="Today's date">
                    <i class="far fa-calendar-alt mr-1 text-xs sm:text-sm" aria-hidden="true"></i>
                    <span class="sm:hidden">{{ today | date:'EEE, MMM. d, y' }}</span>
                    <span class="hidden sm:inline lg:hidden">{{ today | date:'EEE, MMM. d, y' }}</span>
                    <span class="hidden lg:inline">{{ today | date:'EEE, MMM. d, y' }}</span>
                </span>
                <span class="text-gray-600 text-xs sm:text-sm whitespace-nowrap" aria-label="Current time">
                    <i class="far fa-clock mr-1 text-xs sm:text-sm" aria-hidden="true"></i>
                    {{ currentTime }}
                </span>
                <app-notification-bell [panel]="role" [orgId]="authService.getCreatorId()"></app-notification-bell>
                <!-- Add more actions/user info here if needed -->
            </div>
        </div>

        <!-- Main routed content -->
        <router-outlet #outlet="outlet"></router-outlet>
    </div>
</div>